<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: api/api.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: api/api.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as DateJS from 'datejs';

export const apiUrl = 'https://to-do-woman-up-default-rtdb.firebaseio.com';

export const TO_DO_STATUS = {
  IN_PROGRESS: 'in progress',
  COMPLETED: 'completed',
  EXPIRED: 'expired',
};

/**
 * Sends a request to the backend
 * @async
 * @param {*} options
 * @param {String} url
 * @returns {*} response data
 */
export const sendHttpRequest = async (
  options,
  url = `${apiUrl}/todos.json`
) => {
  const method = options?.method;
  const body = options?.body;

  const response = await fetch(
    url,
    options
      ? {
          method: method || 'POST',
          headers: {
            'Content-type': 'application/json',
          },
          body: JSON.stringify(body || {}),
        }
      : {}
  );

  return await response.json();
};

/**
 * Create a to-do
 * @async
 * @param {*} body
 * @return {Array} modified list of todos
 */
export const sendItem = async (body) => {
  const data = await sendHttpRequest({ body });

  return await getData();
};

/**
 * Read all todos
 * @async
 * @returns {Array} modified list of todos
 */
export const getData = async () => {
  const data = await sendHttpRequest();

  const loadedData = [];

  for (let key in data) {
    let isExpired = false;

    if (data[key].status === TO_DO_STATUS.IN_PROGRESS) {
      isExpired = await taskStatusCheck(key, data[key].expiryDate);
    }

    let loadedFiles = [];

    for (let key2 in data[key].files) {
      loadedFiles.push({ id: key, name: data[key].files[key2] }.name);
    }

    loadedData.push({
      id: key,
      description: '',
      ...data[key],
      status: isExpired ? TO_DO_STATUS.EXPIRED : data[key].status,
      files: loadedFiles,
    });
  }

  return loadedData;
};

/**
 * Update one todo
 * @async
 * @param {String} id
 * @param {*} body
 * @returns {Array} modified list of todos
 */
export const editItem = async (id, body) => {
  const data = await sendHttpRequest(
    { method: 'PATCH', body },
    `${apiUrl}/todos/${id}.json`
  );

  return await getData();
};

/**
 * Update a status of one todo
 * @async
 * @param {String} id
 * @param {String} status
 */
export const editStatus = async (id, status) => {
  const data = await sendHttpRequest(
    { method: 'PATCH', body: { status } },
    `${apiUrl}/todos/${id}.json`
  );
};

/**
 * Delete one todo
 * @async
 * @param {String} id
 * @returns {Array} modified list of todos
 */
export const deleteItem = async (id) => {
  const data = await sendHttpRequest(
    { method: 'DELETE' },
    `${apiUrl}/todos/${id}.json`
  );

  return await getData();
};

/**
 * Check whether todo status is expired or not
 * @async
 * @param {String} id
 * @param {String} date
 * @returns {Boolean} true if todo is expired
 */
export const taskStatusCheck = async (id, date) => {
  const isExpired = Date.today().compareTo(Date.parse(date)) > 0;

  if (isExpired) {
    await editStatus(id, TO_DO_STATUS.EXPIRED);
  }

  return isExpired;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Button.html">Button</a></li><li><a href="Input.html">Input</a></li><li><a href="Modal.html">Modal</a></li><li><a href="NewToDo.html">NewToDo</a></li><li><a href="TextArea.html">TextArea</a></li><li><a href="TextField.html">TextField</a></li><li><a href="ToDoForm.html">ToDoForm</a></li><li><a href="ToDoItem.html">ToDoItem</a></li><li><a href="ToDoItemCard.html">ToDoItemCard</a></li><li><a href="ToDoList.html">ToDoList</a></li></ul><h3>Global</h3><ul><li><a href="global.html#deleteItem">deleteItem</a></li><li><a href="global.html#editItem">editItem</a></li><li><a href="global.html#editStatus">editStatus</a></li><li><a href="global.html#getData">getData</a></li><li><a href="global.html#sendHttpRequest">sendHttpRequest</a></li><li><a href="global.html#sendItem">sendItem</a></li><li><a href="global.html#taskStatusCheck">taskStatusCheck</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Mon Nov 28 2022 01:40:48 GMT+0300 (Moscow Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
